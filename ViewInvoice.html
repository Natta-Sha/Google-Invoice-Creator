<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <meta charset="utf-8" />
    <title>Invoice View</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .label {
        font-weight: bold;
      }
      .readonly-box {
        padding: 6px 12px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        min-height: 38px;
      }
      .section {
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body class="container py-4">
    <button class="btn btn-link mb-4" onclick="goHome()">
      ← Back to Main Page
    </button>

    <h2 class="mb-4">Invoice Details</h2>

    <div id="invoice-content">Loading...</div>

    <script>
      function goHome() {
        window.location.href = "?page=Home";
      }

      function renderInvoice(data) {
        if (!data) {
          document.getElementById("invoice-content").innerHTML =
            '<div class="alert alert-danger">Invoice not found.</div>';
          return;
        }

        const container = document.getElementById("invoice-content");
        container.innerHTML = `
          <div class="section row">
            <div class="col-md-4">
              <div class="label">Project Name:</div>
              <div class="readonly-box">${data.projectName}</div>
            </div>
            <div class="col-md-4">
              <div class="label">Invoice Number:</div>
              <div class="readonly-box">${data.invoiceNumber}</div>
            </div>
            <div class="col-md-4">
              <div class="label">Invoice Date:</div>
              <div class="readonly-box">${data.invoiceDate}</div>
            </div>
          </div>

          <div class="section row">
            <div class="col-md-4">
              <div class="label">Client Name:</div>
              <div class="readonly-box">${data.clientName}</div>
            </div>
            <div class="col-md-4">
              <div class="label">Client Number:</div>
              <div class="readonly-box">${data.clientNumber}</div>
            </div>
            <div class="col-md-4">
              <div class="label">Client Address:</div>
              <div class="readonly-box">${data.clientAddress}</div>
            </div>
          </div>

          <div class="section row">
            <div class="col-md-4">
              <div class="label">Subtotal:</div>
              <div class="readonly-box">${data.subtotal}</div>
            </div>
            <div class="col-md-4">
              <div class="label">Tax Rate (%):</div>
              <div class="readonly-box">${data.tax}</div>
            </div>
            <div class="col-md-4">
              <div class="label">Total:</div>
              <div class="readonly-box">${data.total}</div>
            </div>
          </div>

          <div class="section row">
            <div class="col-md-4">
              <div class="label">Currency:</div>
              <div class="readonly-box">${data.currency}</div>
            </div>
            <div class="col-md-4">
              <div class="label">Exchange Rate:</div>
              <div class="readonly-box">${data.exchangeRate}</div>
            </div>
            <div class="col-md-4">
              <div class="label">Amount in EUR:</div>
              <div class="readonly-box">${data.amountInEUR}</div>
            </div>
          </div>

          <div class="section">
            <div class="label">Comment:</div>
            <div class="readonly-box">${data.comment || "-"}</div>
          </div>
        `;
      }

      // ✅ Получаем параметр number из URL вручную
      const urlParams = new URLSearchParams(window.location.search);
      const invoiceNumber = urlParams.get("number");

      if (invoiceNumber) {
        google.script.run
          .withSuccessHandler(renderInvoice)
          .getInvoiceByNumber(invoiceNumber);
      } else {
        document.getElementById("invoice-content").innerHTML =
          '<div class="alert alert-warning">No invoice number provided in URL.</div>';
      }
    </script>
  </body>
</html>
