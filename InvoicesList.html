<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <meta charset="UTF-8" />
    <title>List of Invoices</title>

    <!-- ✅ Стили -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- ✅ Скрипты -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

    <style>
      /* Ширина колонок */
      #invoiceTable {
        width: 100% !important;
      }

      #invoiceTable th,
      #invoiceTable td {
        vertical-align: middle;
      }

      #invoiceTable th:nth-child(1),
      #invoiceTable td:nth-child(1) {
        width: 30%;
      }

      #invoiceTable th:nth-child(2),
      #invoiceTable td:nth-child(2) {
        width: 15%;
      }

      #invoiceTable th:nth-child(3),
      #invoiceTable td:nth-child(3) {
        width: 20%;
      }

      #invoiceTable th:nth-child(4),
      #invoiceTable td:nth-child(4) {
        width: 10%;
        text-align: right;
      }

      #invoiceTable th:nth-child(5),
      #invoiceTable td:nth-child(5) {
        width: 25%;
        text-align: center;
      }

      /* Фильтры */
      thead input {
        width: 100%;
        padding: 3px;
        font-size: 0.875rem;
        box-sizing: border-box;
      }
    </style>
  </head>

  <body class="container py-4">
    <button class="btn btn-link mb-3" onclick="goHome()">
      ← Back to Main Page
    </button>
    <h2 class="mb-4">List of Invoices</h2>

    <table id="invoiceTable" class="display table table-bordered align-middle">
      <thead class="table-light">
        <!-- Основной заголовок -->
        <tr>
          <th>Project Name</th>
          <th>Invoice Number</th>
          <th>Invoice Date</th>
          <th>Total</th>
          <th>Actions</th>
        </tr>
        <!-- Фильтры -->
        <tr>
          <th>
            <input
              type="text"
              placeholder="Search"
              class="form-control form-control-sm"
            />
          </th>
          <th>
            <input
              type="text"
              placeholder="Search"
              class="form-control form-control-sm"
            />
          </th>
          <th>
            <input
              type="text"
              placeholder="Search"
              class="form-control form-control-sm"
            />
          </th>
          <th>
            <input
              type="text"
              placeholder="Search"
              class="form-control form-control-sm text-end"
            />
          </th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      function goHome() {
        google.script.run
          .withSuccessHandler(function (html) {
            document.open();
            document.write(html);
            document.close();
          })
          .loadPage("Home");
      }

      $(document).ready(function () {
        const table = $("#invoiceTable").DataTable({
          orderCellsTop: true,
          fixedHeader: true,
        });

        // Фильтрация по каждому столбцу
        $("#invoiceTable thead tr:eq(1) th input").on(
          "keyup change",
          function () {
            const colIndex = $(this).parent().index();
            table.column(colIndex).search(this.value).draw();
          }
        );

        // Загрузка данных
        google.script.run
          .withSuccessHandler(function (data) {
            if (!Array.isArray(data) || data.length === 0) return;

            data.forEach((row) => {
              table.row.add([
                row.projectName || "",
                row.invoiceNumber || "",
                row.invoiceDate || "",
                row.total || "",
                `
                <button class="btn btn-sm btn-outline-primary me-1">View</button>
                <button class="btn btn-sm btn-outline-secondary me-1">Edit</button>
                <button class="btn btn-sm btn-outline-danger me-1">Delete</button>
                <button class="btn btn-sm btn-outline-success">Copy</button>
              `,
              ]);
            });

            table.draw();
          })
          .getInvoiceList();
      });
    </script>
  </body>
</html>
